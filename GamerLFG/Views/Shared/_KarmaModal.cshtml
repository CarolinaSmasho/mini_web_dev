@* Karma Rating Modal - Include in layout or pages that need rating functionality *@

<div class="karma-modal-overlay" id="karmaModal" style="display: none;">
    <div class="karma-modal card">
        <button class="modal-close" onclick="closeKarmaModal()">
            <i data-lucide="x"></i>
        </button>
        
        <div class="karma-modal-header">
            <i data-lucide="star" class="karma-icon"></i>
            <h2>Rate Your Teammates</h2>
            <p>How was your gaming session? Your ratings help build our community!</p>
        </div>

        <div class="karma-players" id="karmaPlayers">
            <!-- Player Rating Card -->
            <div class="player-rating-card">
                <div class="player-info">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=ProGamer" alt="Player" class="player-avatar" />
                    <span class="player-name">ProGamer_X</span>
                </div>
                
                <div class="rating-stars" data-player="ProGamer_X">
                    <button class="star-btn" data-value="1">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="2">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="3">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="4">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="5">
                        <i data-lucide="star"></i>
                    </button>
                </div>
                
                <div class="rating-tags">
                    <button class="rating-tag" data-tag="Good Comms">üé§ Good Comms</button>
                    <button class="rating-tag" data-tag="Team Player">ü§ù Team Player</button>
                    <button class="rating-tag" data-tag="Skilled">üéØ Skilled</button>
                    <button class="rating-tag" data-tag="Positive">üòä Positive</button>
                </div>
            </div>

            <div class="player-rating-card">
                <div class="player-info">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=TankMaster" alt="Player" class="player-avatar" />
                    <span class="player-name">TankMaster</span>
                </div>
                
                <div class="rating-stars" data-player="TankMaster">
                    <button class="star-btn" data-value="1">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="2">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="3">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="4">
                        <i data-lucide="star"></i>
                    </button>
                    <button class="star-btn" data-value="5">
                        <i data-lucide="star"></i>
                    </button>
                </div>
                
                <div class="rating-tags">
                    <button class="rating-tag" data-tag="Good Comms">üé§ Good Comms</button>
                    <button class="rating-tag" data-tag="Team Player">ü§ù Team Player</button>
                    <button class="rating-tag" data-tag="Skilled">üéØ Skilled</button>
                    <button class="rating-tag" data-tag="Positive">üòä Positive</button>
                </div>
            </div>
        </div>

        <div class="karma-modal-actions">
            <button class="btn btn-secondary" onclick="closeKarmaModal()">Skip</button>
            <button class="btn btn-primary" onclick="submitKarmaRatings()">
                <i data-lucide="send"></i> Submit Ratings
            </button>
        </div>
    </div>
</div>

<style>
/* Karma Modal Overlay */
.karma-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: var(--spacing-lg);
}

.karma-modal {
    width: 100%;
    max-width: 520px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: modalSlideIn 0.3s ease;
}

@@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-close {
    position: absolute;
    top: var(--spacing-md);
    right: var(--spacing-md);
    background: transparent;
    border: none;
    color: var(--color-smoke-gray);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    color: var(--color-ghost-white);
    background: var(--color-midnight-light);
}

.modal-close i {
    width: 24px;
    height: 24px;
}

/* Modal Header */
.karma-modal-header {
    text-align: center;
    margin-bottom: var(--spacing-lg);
}

.karma-icon {
    width: 48px;
    height: 48px;
    color: var(--color-primary-orange);
    margin-bottom: var(--spacing-sm);
}

.karma-modal-header h2 {
    font-size: 1.5rem;
    margin-bottom: var(--spacing-xs);
}

.karma-modal-header p {
    color: var(--color-smoke-gray);
}

/* Player Rating Cards */
.karma-players {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.player-rating-card {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--color-midnight);
    border-radius: var(--radius-md);
}

.player-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.player-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid var(--color-primary-orange);
}

.player-name {
    font-weight: 600;
    font-size: 1.125rem;
}

/* Star Rating */
.rating-stars {
    display: flex;
    gap: var(--spacing-xs);
}

.star-btn {
    background: transparent;
    border: none;
    padding: var(--spacing-xs);
    cursor: pointer;
    color: var(--color-dark-gray);
    transition: all var(--transition-fast);
}

.star-btn:hover,
.star-btn.hovered {
    color: var(--color-golden);
    transform: scale(1.1);
}

.star-btn.selected {
    color: var(--color-golden);
}

.star-btn i {
    width: 32px;
    height: 32px;
}

/* Rating Tags */
.rating-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-xs);
}

.rating-tag {
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--color-midnight-light);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-full);
    color: var(--color-smoke-gray);
    font-size: 0.75rem;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.rating-tag:hover {
    border-color: var(--color-primary-orange);
    color: var(--color-ghost-white);
}

.rating-tag.selected {
    background: var(--color-primary-orange);
    border-color: var(--color-primary-orange);
    color: white;
}

/* Modal Actions */
.karma-modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--glass-border);
}
</style>

<script>
    // Initialize when modal is shown
    function initKarmaModal() {
        lucide.createIcons();
        
        // Star rating hover/click logic
        document.querySelectorAll('.rating-stars').forEach(starsContainer => {
            const stars = starsContainer.querySelectorAll('.star-btn');
            
            stars.forEach((star, index) => {
                star.addEventListener('mouseenter', () => {
                    stars.forEach((s, i) => {
                        s.classList.toggle('hovered', i <= index);
                    });
                });
                
                star.addEventListener('click', () => {
                    stars.forEach((s, i) => {
                        s.classList.toggle('selected', i <= index);
                    });
                    starsContainer.dataset.rating = index + 1;
                });
            });
            
            starsContainer.addEventListener('mouseleave', () => {
                stars.forEach(s => s.classList.remove('hovered'));
            });
        });
        
        // Rating tags toggle
        document.querySelectorAll('.rating-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                this.classList.toggle('selected');
            });
        });
    }

    function openKarmaModal() {
        document.getElementById('karmaModal').style.display = 'flex';
        initKarmaModal();
    }

    function closeKarmaModal() {
        document.getElementById('karmaModal').style.display = 'none';
    }

    function submitKarmaRatings() {
        const ratings = [];
        
        document.querySelectorAll('.player-rating-card').forEach(card => {
            const playerName = card.querySelector('.player-name').textContent;
            const starsContainer = card.querySelector('.rating-stars');
            const rating = starsContainer.dataset.rating || 0;
            const tags = Array.from(card.querySelectorAll('.rating-tag.selected'))
                .map(tag => tag.dataset.tag);
            
            ratings.push({ player: playerName, rating, tags });
        });
        
        console.log('Submitting ratings:', ratings);
        // TODO: API call
        
        closeKarmaModal();
        alert('Thanks for rating your teammates! üéÆ');
    }
    
    // Close modal on overlay click
    document.getElementById('karmaModal')?.addEventListener('click', function(e) {
        if (e.target === this) {
            closeKarmaModal();
        }
    });
</script>
